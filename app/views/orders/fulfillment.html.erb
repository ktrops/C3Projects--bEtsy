<h2>Order Fulfillment</h2>

<% if @filtered_order_items == nil %>
<div class="panel panel-info">
  <div class="table-responsive">
    <table class="table">
      <thead>
        <tr>
          <th>
            Orders
          </th>
          <th>
            Number
          </th>
          <th>
            Revenue
          </th>
        </tr>
      </thead>
      <tbody>
        <tr class="active">
          <td>
            Total
          </td>
          <td>
            <span class="badge">
              <%= @order_items.count %>
            </span>
          </td>
          <td>
            <%= readable_price(@total_revenue) %>
          </td>
        </tr>
        <tr>
          <td>
            Pending
          </td>
          <td>
            <span class="badge">
              <%= pending_orders %>
            </span>
          </td>
          <td>
            <%= readable_price(pending_order_revenue) %>
          </td>
        </tr>
        <tr>
          <td>
            Paid
          </td>
          <td>
            <span class="badge">
              <%= paid_orders %>
            </span>
          </td>
          <td>
            <%= readable_price(paid_order_revenue) %>
          </td>
        </tr>
        <tr>
          <td>
            Complete
          </td>
          <td>
            <span class="badge">
              <%= complete_orders %>
            </span>
          </td>
          <td>
            <%= readable_price(complete_order_revenue) %>
          </td>
        </tr>
        <tr>
          <td>
            Cancelled
          </td>
          <td>
            <span class="badge">
              <%= cancelled_orders %>
            </span>
          </td>
          <td>
            <%= readable_price(cancelled_order_revenue) %>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<% end %>

<p>
  <%= form_tag order_status_path, method: "get" do %>

    <div class="form-group inline-form">
      <%= select_tag "status", options_for_select([["Pending", "pending"], ["Paid", "paid"], ["Complete", "complete"], ["Cancelled", "cancelled"]]), include_blank: "Filter by...", class: "form-control fit-width" %>
    </div>

    <%= submit_tag "Filter by Status", class: "btn btn-default" %>

  <% end %>
</p>

<p>
  <%= link_to "See All Orders", order_fulfillment_path, class: "btn btn-default" %>
</p>

<% if @filtered_order_items == nil %>
  <% @order_items.each do |order_item| %>
    <br>
    <div class="table-responsive">
      <table class="table">
        <tbody>
          <tr class="active">
            <td>
              Order
            </td>
            <td>
              <%= link_to "#{order_item.order_id}", user_order_path(user_id: @user.id, id: order_item.order_id), class: "btn btn-default" %>
            </td>
          </tr>
          <tr>
            <td>
              Product
            </td>
            <td>
              <%= link_to order_item.product.name, product_path(id: order_item.product_id), class: "btn btn-default" %>
            </td>
          </tr>
          <tr>
            <td>
              Quantity
            </td>
            <td>
              <%= order_item.quantity %>
            </td>
          </tr>
          <tr>
            <td>
              Item Total
            </td>
            <td>
              <%= readable_price(order_item.item_total) %>
            </td>
          </tr>
          <tr>
            <td>
              Date Placed
            </td>
            <td>
              <%= readable_date(order_item.created_at) %>
            </td>
          </tr>
          <tr>
            <td>
              Payment Status
            </td>
            <td>
              <%= order_item.order.status.capitalize %>
            </td>
          </tr>
          <tr>
            <td>
              Shipping Status
            </td>
            <td>
              <p>
                <%= frendly_shipped_status(order_item.order.shipped) %>
              </p>
              <% unless order_item.order.shipped == true %>
                <%= link_to "Mark Shipped", mark_shipped_path(@user, order_id: order_item.order.id), method: :put, class: "btn btn-warning" %>
              <% end %>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  <% end %>

<% else %>

  <h3>Filtered by <%= params[:status].capitalize %> Orders</h3>
  <% @filtered_order_items.each do |order_item| %>
    <br>
    <div class="table-responsive">
      <table class="table">
        <tbody>
          <tr class="active">
            <td>
              Order
            </td>
            <td>
              <%= link_to "#{order_item.order_id}", user_order_path(user_id: @user.id, id: order_item.order_id), class: "btn btn-default" %>
            </td>
          </tr>
          <tr>
            <td>
              Product
            </td>
            <td>
              <%= link_to order_item.product.name, product_path(id: order_item.product_id), class: "btn btn-default" %>
            </td>
          </tr>
          <tr>
            <td>
              Quantity
            </td>
            <td>
              <%= order_item.quantity %>
            </td>
          </tr>
          <tr>
            <td>
              Item Total
            </td>
            <td>
              <%= readable_price(order_item.item_total) %>
            </td>
          </tr>
          <tr>
            <td>
              Date Placed
            </td>
            <td>
              <%= readable_date(order_item.created_at) %>
            </td>
          </tr>
          <tr>
            <td>
              Payment Status
            </td>
            <td>
              <%= order_item.order.status.capitalize %>
            </td>
          </tr>
          <tr>
            <td>
              Shipping Status
            </td>
            <td>
              <p>
                <%= frendly_shipped_status(order_item.order.shipped) %>
              </p>
              <% unless order_item.order.shipped == true %>
                <%= link_to "Mark Shipped", mark_shipped_path(@user, order_id: order_item.order.id), method: :put, class: "btn btn-warning" %>
              <% end %>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  <% end %>

<% end %>
