<h1>Order <%= @order.id %></h1>

<% if @order.status == "pending" %>
  <p>
    Order is pending. No customer information yet.
  </p>
<% else %>
  <div class ="col-md-6">
    <h3>Customer Information</h3>
    <table class = "table">
      <tbody>
        <tr>
          <th>
            Buyer:
          </th>
          <td>
            <%= @order.mailing_name %>
          </td>
        </tr>
        <tr>
          <th>
            Email Address:
          </th>
          <td>
            <%= @order.email %>
          </td>
        </tr>
        <tr>
          <th>
            Mailing Address:
          </th>
          <td>
            <%= "#{@order.address1}, #{@order.city}, #{@order.state} #{@order.mailing_zip}" %>
          </td>
        </tr>
        <tr>
          <th>
            Last 4 of Credit Card:
          </th>
          <td>
            <%= @order.cc_number[-4..-1] %>
          </td>
        </tr>
        <tr>
          <th>
            Credit Card Expiration Date:
          </th>
          <% unless @order.cc_expiration.nil? %>
            <td>
              <%= @order.cc_expiration.month %>/<%=@order.cc_expiration.year%>
            </td>
          <% end %>
        </tr>
      </tbody>
    </table>
  </div>
<% end %>

<div class = "col-md-6">
  <h3>Order Details</h3>
  <table class = "table">
    <thead>
      <tr>
        <th>
          Product
        </th>
        <th>
          Quantity
        </th>
        <th>
          Subtotal
        </th>
      </tr>
    </thead>
    <tbody>
      <% @order.order_items.each do |x| %>
      <% if @user_items.include?(x) == true %>
        <tr>
          <td>
            <%= x.product.name %>
          </td>
          <td>
            <%= x.quantity %>
          </td>
          <td>
            <!-- if pending, show quantity * product.price, else show item_total -->
            <% if @order.status == "pending" %>
              $<%= (x.quantity * x.product.price)/100 %>
            <% else %>
              $<%= x.item_total/100 %>
            <% end %>
          </td>
        </tr>
        <% end  %>
      <% end %>
      <tr>
        <th colspan="2">
          Order Total
        </th>
        <td>
           $<%= @total_sales %>
        </td>
      </tr>
      <tr>
        <th colspan="2">
          Status:
        </th>
        <td>
          <%= @order.status %>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<div class="row">
  <div class="col-lg-12">
    <p>
      <%= link_to "Back to Order Fulfillment", :back, class: "btn btn-default" %>
    </p>
  </div>
</div>
